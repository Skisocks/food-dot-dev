{{ define "main" }}
<article class="recipe-single">
  <header class="recipe-header">
    <h1 class="recipe-title">{{ .Title }}</h1>

    <div class="recipe-meta">
      {{ with .Params.prepTime }}
      <div class="meta-item">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"></circle>
          <polyline points="12 6 12 12 16 14"></polyline>
        </svg>
        <span><strong>Prep:</strong> {{ . }}</span>
      </div>
      {{ end }}

      {{ with .Params.cookTime }}
      <div class="meta-item">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M6.13 1L6 16a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V1"></path>
          <path d="M3 6h18"></path>
        </svg>
        <span><strong>Cook:</strong> {{ . }}</span>
      </div>
      {{ end }}

      {{ with .Params.servings }}
      <div class="meta-item">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
          <circle cx="9" cy="7" r="4"></circle>
          <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
          <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
        </svg>
        <span><strong>Servings:</strong> {{ . }}</span>
      </div>
      {{ end }}

      {{ with .Params.difficulty }}
      <div class="meta-item">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
        </svg>
        <span><strong>Difficulty:</strong> {{ . }}</span>
      </div>
      {{ end }}
    </div>

    {{ with .Params.featured_image }}
    <div class="recipe-image">
      <img src="{{ . }}" alt="{{ $.Title }}">
    </div>
    {{ end }}

    <div class="recipe-taxonomies">
      {{ with .Params.categories }}
      <div class="taxonomy-group">
        <strong>Categories:</strong>
        {{ range . }}
        <a href="{{ "/categories/" | relLangURL }}{{ . | urlize }}" class="badge badge-category">{{ . }}</a>
        {{ end }}
      </div>
      {{ end }}

      {{ with .Params.cuisines }}
      <div class="taxonomy-group">
        <strong>Cuisine:</strong>
        {{ range . }}
        <a href="{{ "/cuisines/" | relLangURL }}{{ . | urlize }}" class="badge badge-cuisine">{{ . }}</a>
        {{ end }}
      </div>
      {{ end }}

      {{ with .Params.tags }}
      <div class="taxonomy-group">
        <strong>Tags:</strong>
        {{ range . }}
        <a href="{{ "/tags/" | relLangURL }}{{ . | urlize }}" class="badge badge-tag">{{ . }}</a>
        {{ end }}
      </div>
      {{ end }}
    </div>

    {{ if or .Params.source .Params.source_url }}
    <div class="recipe-source">
      {{ if .Params.source_url }}
        {{ $url := urls.Parse .Params.source_url }}
        <img src="https://www.google.com/s2/favicons?domain={{ $url.Host }}&sz=32" alt="" class="source-favicon" width="20" height="20">
      {{ else }}
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
          <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
          <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
        </svg>
      {{ end }}
      <span>
        <strong>Adapted from:</strong>
        {{ if .Params.source_url }}
        <a href="{{ .Params.source_url }}" target="_blank" rel="noopener">{{ .Params.source | default .Params.source_url }}</a>
        {{ else }}
        {{ .Params.source }}
        {{ end }}
      </span>
    </div>
    {{ end }}
  </header>

  <div class="screen-wake-lock">
    <label class="wake-lock-toggle">
      <input type="checkbox" id="wakeLockToggle">
      <span class="toggle-slider"></span>
      <span class="toggle-label">Keep screen on</span>
    </label>
  </div>

  {{ with .Params.ingredients }}
  <section class="recipe-ingredients">
    <div class="ingredients-header">
      <h2>Ingredients</h2>
      <button class="copy-ingredients-btn" onclick="copyIngredientNames()" title="Copy ingredient names">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
          <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
        </svg>
        <span class="btn-text">Copy list</span>
      </button>
    </div>
    <table class="ingredients-table">
      <thead>
        <tr>
          <th scope="col">Quantity</th>
          <th scope="col">Ingredient</th>
        </tr>
      </thead>
      <tbody>
        {{ range . }}
        <tr>
          <td class="ingredient-qty">{{ .qty }}</td>
          <td class="ingredient-name">{{ .name }}</td>
        </tr>
        {{ end }}
      </tbody>
    </table>
  </section>
  <script>
    function copyIngredientNames() {
      const names = Array.from(document.querySelectorAll('.ingredient-name'))
        .map(el => el.textContent.trim())
        .join('\n');
      navigator.clipboard.writeText(names).then(() => {
        const btn = document.querySelector('.copy-ingredients-btn .btn-text');
        const originalText = btn.textContent;
        btn.textContent = 'Copied!';
        setTimeout(() => btn.textContent = originalText, 2000);
      });
    }
  </script>
  {{ end }}

  <div class="recipe-content">
    {{ .Content }}
  </div>

  <footer class="recipe-footer">
    <p><em>Published on {{ .Date.Format "January 2, 2006" }}</em></p>
    {{ with .GitInfo }}
    <div class="recipe-version-info">
      <p>
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle;">
          <circle cx="12" cy="12" r="10"></circle>
          <polyline points="12 6 12 12 16 14"></polyline>
        </svg>
        Last updated: {{ .AuthorDate.Format "January 2, 2006" }}
      </p>
      {{ with $.Site.Params.github_repo }}
      <p>
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle;">
          <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
        </svg>
        <a href="{{ . }}/commits/main/content/{{ $.File.Path }}" target="_blank" rel="noopener">View revision history</a>
      </p>
      {{ end }}
    </div>
    {{ end }}
  </footer>
</article>

{{ $wakeLock := resources.Get "js/wake-lock.js" }}
<script src="{{ $wakeLock.RelPermalink }}"></script>
{{ end }}
